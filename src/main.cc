#include <SDL2/SDL.h>

#include <stdio.h>
#include <algorithm>

#include <engine/game.h>
#include <engine/resource_manager.h>
#include <engine/input_manager.h>
#include <engine/timer.h>

#include "scene/main_scene.h"

int main(int argc, char **argv) {

    // Game loop start
    float target_fps = 20;
    float frame_limit = 1000.f/target_fps;
    float delta = frame_limit;
    
    ResourceManager::startWorkerThread();
    Game::init("SDL Test", 1280, 768);
    Game::setScene(new MainScene);
    Timer timer;
    while (Game::isRunning()) {
        timer.start();

        // input
        Game::handleInput();

        // update
        Game::update(delta/1000.f);

        // render
        Game::render();

        delta = timer.getTicks();
        
        if(delta < frame_limit){
            SDL_Delay(frame_limit-delta);
            delta = frame_limit;
        }
    }

    Game::destroy();
    return 0;
}

/*
-++++++++++++++**:.........:#.........=#..... #*:............*-.....  -+========.
+%%%%%%%%%%%%%@%+++******=%@==++++++=#@*=++++%#=++++++++++++#@*=++*#=#:%%#######=
+%%%%%%%%%%#%@#+++****##=#@==++++++=-@@-++++*++++++++=+*#+*+@@+=+=##-%@.%%######=
+%%%%%%%%%%%@%++*******=+@#=+++++#+-@@+=++++#=+++===+%%**%+-%@==#=%%-*@=+%######=
+%%%%%%%%%%%@*+****+*#==@@-+++++*#-#@@:++++#**#*=+@@@#%%+=:=%@:+@=@#-*@@ @%#####=
+%%%%%%%%%%@#=+*****#+=#@+=++++=#+-@@%-*++*@@#=+@@@@#-:---:=@@.@*=@+-*@@.=%%####=
+%%%%%%%%#%%*+**+++**==@@=+++++=%=%@@@=%++%:  @@%=:.:-====:+@@:@:#@+++@@% @%####=
+%%%%%%%%%@@**#++++%+=*@@=++++=##=@*:@=%=*# +@@..:========:%@#*@:@@=#*@@@ @%####=
+%%%%%%%%@%+**+++***==@@#=++++=#*@@ -@*%-+++@= .-=========:%@*@*%@%=%*%@@ @%####=
+%%##%%%%+****+++*#+=+@@#=++++=%%@:  @@#-+@%@@@+.:-======-:%@#@:%@@*@*@@% @%####=
+%%#%%#-#@%+#+++#*%==#@@#-#*++*@@-%@@@@%-++@@@@@@%+=--====:*@@@ #@%#%*@@* %%####=
+%%###@%@#%=#=+=%=%-=@@@%-@++=+@*#@-  @@=+:*   #*-=+*#=-=--*@@@ *@@#%#@@.-######=
+%%%%##%%*%+%=+*%-@=*@@@@:%*==%@-.+#: +@++@@@@-.-=---===++-*%@@ %@@%%@@% +@#%###=
+%%%%%##@*#+*++%*=@-%@%#@*##-=@*.--=@.:@++*+%@%-=========-+@@@@--@@+#@@ *.@*####=
+%%%%%#%#@+#+++#++%=@@**%@=@:=@*:--==-#@=*=-:::-==========+: @@@@%#.#@* @.@#####=
+%%%%%#%+@=#=*##+-%@@####@%@--@*+--=-:@#+*##@*===========::=:-@.@@#+@@ @+#%*####=
=####%%%*@=%+##+*@@@#*##*#@@@=@@#*--:=@++-::--============%%@#@*#@*@@ +@ @######=
=#######@%++++=%*=@%*+****%@@@@@%@#*-%+*==============----+++  -@@@% :@*+@#*####=
=#######@+*++@%==@@@@%####%@@@@@@@%#+##:-==============@*-**-:. @@% .@@.%%*#####-
=######@@-+%#=-+@@%%@@@@%*+=*%%%##%@@#++--..  ..:-====--+--+@*+-@@.:@@+#%#######-
=###%@#==%@*=-*@@%%%%%%@@@@@@@@@#++@##%%= =@@@#=:. .:======---.#@..@@@#%########-
=%%%*-+@#*==-#@@%%%%%%%%%@%*+++*@@##@@@=.%@@@@@@@@@%= :-=====:-@:.@@@@+#########-
+#++#@@@+==+@@@@@@%%%%%%%%@#*##*#@*---*:@@@@@@@@@@@@@@@:====-:@+ @@%@*-%#######*-
-#%@@@@=-:#@@@%##%@%%%%%%%@%*####+==-#@+@%+-:-=*#@@@@@#.===-.@@ @@%%@=+%########-
+#%@%+-:+@@@*:::+*%%%%%%%%@%#*=-::-*@@*+::=*%#++=--@@@.:==:.=@ @@%%%@.%%%#######-
+@@+::=@@@@@%**@@@@%%%%%%%%@@@@@@@@%- .--=-::=*###+@@*.-:.:%@@ @#%%@@.%@########-
=-..*@@@+#%@@#@@@%%%%%%%%%@#######**= :-=====-----::--. .%@@@@ @@%%%*-%#########-
.%@@@@@#@@@@@@@@@%%%%%%%%@@*******##@@+.:=======--.  .%@@@@%%@@.-@@@-+%#*#******:
+*---:.:: @@==*@@@@@%%%%@@**##########@@=..---.. .=@@@@@%%%%%%@@%*#@+#@%%#@@@@@@*
 :   .::-.@+.:.   *@@%%%@%**###########%@@#: .*@@@@@@@@%%%%%%%%%%@@*=%%-=@#***##:
=@@@%-.:-:=:----*@@%@@@@@**##############*@@@@@@@@%%%%@%%%%%%%%%%%@++@:+@%%##*#%-
-###%@@-.:----=**+: .#@%***#############**@@%%%%%%%%%%@%%%%%%%%%%%@+=@=%*%@%**#%-
-%####%@@..----:.:---=#@%##############*+#%#%##%###%%%%#%%%%%%%%%%@@=-*%*%@%**%@*
 @%#####@@+::::=*=---:..%@%############*#@@@@@@@@@@@@@%%%#%%@@%%%%%@#.@%#%##@@%@.
 -@######%@* +@+:------::-#@@@%######*#**@@@#===++   @@@@@%*-#%%%%%%@++@@@%##%%@ 
 :%%######%%*#@%:-=-----=--. -@@@@%###*#*+=++**##%=:+@%@@@@@@@%%%%%%@## @%=#%%#@=
 :=@###########%%:--------:-@::..+@@#%@@%%%%#%%@@%*+-.  =@@@@@@@@%%%%%=@.=@@@%%%+
 :-@############@+:--------+#:===:.=%@@@@@%%%%#=.=-:---=:-@@@@@@@@@@%@@==@+-*%##*
 -:#%############@+=#*===+:%%%@%#@@@**+%#+=*%*=*@@*+*#*+**@@@@@@@@@@@%@@---=#%**-
 -:*%############%@  =@@=@*@*  .%    @   @@:  @@  #@ - %@   @ @@@@@@@@*@%-=%@#**-
 -:+@#############@             @    @   -    #    @    +   @ @@@@@@@@@%+*@#***#-
 -:+@#############@ -  @@@*@ . .@   -@   *@ @ @@  %@   -@ . @ @@@@@@@%@@@#####*#-
 -:+%##########%%%@@@@@=.::+*@@%#@@%**#@%*%@%*++@@*+#@%@@%@*=@@@@@@@@@@@@#####*#-
   :=---------:     :-+++=        =                           @          .------.
*/